name: Ad Hoc (Actions Development)

# For tags beginning with 'adhoc-', run integration tests.

on:
  push:
    tags:
      - "adhoc-*"

jobs:
  onsite-tests:
    strategy:
      matrix:
        module: ["core", "perception", "calibration", "tractor"]
    runs-on: [self-hosted]
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: "recursive"
      - name: Test
        run: ./env.sh python -m unittest modules/${{ matrix.module }}/tests/integration_test.py
  onsensorbox-tests:
    strategy:
      matrix:
        module: ["perception", "calibration", "tractor"]
    runs-on: [self-hosted, sensorbox]
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: "recursive"
      - name: Test
        run: ./env.sh python -m unittest modules/${{ matrix.module }}/tests/sensorbox_integration_test.py
  ontractor-tests:
    strategy:
      matrix:
        module: ["tractor"]
    runs-on: [self-hosted, tractor]
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: "recursive"
      - name: Test
        run: ./env.sh python -m unittest modules/${{ matrix.module }}/tests/tractor_integration_test.py
